# 5분 방패 AI - 프로젝트 진행 현황 및 개요

## 📋 프로젝트 개요

**5분 방패 AI**는 낯선 전화가 오면 AI가 최대 5분간 대신 통화하여 피싱 여부를 분석하고, 사용자는 통화 결과 보고서만 보고 안전하게 판단하는 AI 기반 피싱 예방 서비스입니다.

### 핵심 가치
- 사용자는 사기범과 직접 대화하지 않는다
- 피싱 위험은 통화 이후가 아닌, 통화 순간에 차단한다

---

## 🚀 개발 진행 과정

### 1단계: 초기 설계 및 백엔드 구축
- **기간**: 프로젝트 시작
- **작업 내용**:
  - Flask 백엔드 서버 구축
  - REST API 엔드포인트 설계 (`/health`, `/api/call/start`, `/api/call/end`)
  - CORS 설정 및 기본 서비스 구조 생성
  - 환경 변수 관리 시스템 구축

### 2단계: 프론트엔드 개발 (React Native → 웹앱 전환)
- **초기 계획**: React Native 모바일 앱
- **전환 이유**: 테스트 및 프로토타이핑 용이성을 위해 웹앱으로 전환
- **최종 결정**: React CDN을 사용한 순수 웹앱 (HTML/JS)
- **작업 내용**:
  - React Native 구조에서 웹앱으로 완전 전환
  - `index.html` + `app-full.js` 구조로 단순화
  - CDN 기반 React 사용 (빌드 과정 없음)

### 3단계: 핵심 기능 구현
- **AI 대리 통화 시뮬레이션**:
  - 18턴의 피싱 시나리오 대화 구현
  - AI 응답을 당황하고 헷갈리는 톤으로 구현 (피싱에 당하는 사람의 심리 반영)
  - 실시간 대화 표시 및 타이머 기능

- **실시간 스캠 점수 계산**:
  - 6가지 피싱 패턴 정의 및 가중치 부여
    - 기관 사칭 (15%): 금융감독원, 검찰, 경찰 등
    - 긴급성 압박 (12%): 지금 당장, 서두르세요 등
    - 개인정보 요구 (20%): 계좌번호, 비밀번호 등
    - 법적 위협 (18%): 법적 책임, 동결 등
    - 송금 요구 (22%): 송금, 이체 등
    - 비정상 접근 (10%): 특별 절차, 비공개 등
  - 통화 중 실시간 점수 업데이트
  - 패턴 감지 시 누적 방식으로 점수 증가

- **리포트 생성**:
  - 통화 종료 시 자동 리포트 생성
  - 판별 결과: 정상 / 의심 / 피싱 확정
  - 판단 근거, 스캠 유형, 권장 행동 가이드 포함
  - 통화 중 계산된 점수를 리포트에 정확히 반영

### 4단계: 히스토리 및 상세 기능 구현
- **히스토리 화면**:
  - 통화 이력 목록 표시
  - 유형별 필터링 (정상/의심/피싱 확정)
  - 번호 검색 기능
  - 각 통화에 대한 짧은 코멘트 추가 기능

- **상세 화면**:
  - 번호 클릭 시 상세 정보 표시
  - 통화 내용 전체 보기
  - 리포트 요약 및 증거 표시

- **설정 화면**:
  - 기본 설정 관리

### 5단계: 버그 수정 및 개선
- **점수 일치 문제 해결**:
  - 통화 중 점수와 리포트 점수 불일치 문제 해결
  - `useRef`를 사용한 최신 값 보장
  - 리포트 생성 시점에 최신 state와 ref 확인
  - 리포트 생성 직후 최종 확인 및 보정 로직 추가

- **피싱 패턴 분석 개선**:
  - 패턴 감지 로직 정교화
  - 점수 계산 로직 개선 (누적 방식)
  - 패턴이 감지되면 최소 "의심"으로 분류

---

## 🛠 현재 기술 스택

### Backend
- **프레임워크**: Flask (Python)
- **주요 라이브러리**:
  - Flask-CORS: CORS 처리
  - python-dotenv: 환경 변수 관리
  - OpenAI (계획): AI 대화 생성
  - Twilio (계획): VoIP 통화
- **서버**: `http://localhost:5000`

### Frontend
- **구조**: 순수 웹앱 (HTML + JavaScript)
- **라이브러리**: React 18 (CDN)
- **스토리지**: localStorage (클라이언트 사이드 데이터 저장)
- **서버**: `npx serve` (포트 3000)

### 데이터 흐름
```
사용자 → 웹앱 (frontend/index.html)
  ↓
API 호출 (callService)
  ↓
Flask 백엔드 (backend/app.py)
  ↓
서비스 레이어 (services/)
  ↓
응답 반환
  ↓
웹앱에서 리포트 표시
```

---

## 📁 현재 프로젝트 구조

```
police/
├── backend/                    # Flask 백엔드
│   ├── app.py                 # 메인 Flask 애플리케이션
│   ├── config.py              # 설정 파일
│   ├── run.py                 # 서버 실행 스크립트
│   ├── services/              # 비즈니스 로직
│   │   ├── ai_service.py      # AI 대화 서비스
│   │   ├── scam_analyzer.py   # 스캠 분석 서비스
│   │   ├── stt_service.py     # 음성 인식 서비스
│   │   └── voip_service.py    # VoIP 통화 서비스
│   ├── models/                # 데이터 모델
│   └── utils/                 # 유틸리티 함수
│
├── frontend/                   # 웹앱 프론트엔드
│   ├── index.html             # 메인 HTML 파일
│   ├── app-full.js            # React 앱 전체 코드
│   ├── package.json           # Node.js 의존성 (serve용)
│   └── start-server.bat       # 웹 서버 실행 스크립트
│
├── README.md                   # 프로젝트 개요
├── SETUP.md                    # 설치 가이드
├── PROJECT_STATUS.md           # 이 문서 (진행 현황)
├── requirements.txt            # Python 의존성
├── start-backend.ps1           # 백엔드 실행 스크립트
└── start-frontend.ps1          # 프론트엔드 실행 스크립트
```

---

## ✅ 구현 완료된 기능

### 1. AI 대리 통화 시뮬레이션
- ✅ 전화 수신 화면
- ✅ AI 대신 받기 기능
- ✅ 18턴 피싱 시나리오 대화
- ✅ 실시간 대화 표시
- ✅ 통화 타이머 (경과 시간 표시)

### 2. 실시간 스캠 점수 계산
- ✅ 6가지 피싱 패턴 정의
- ✅ 패턴 감지 시 점수 증가
- ✅ 실시간 점수 업데이트 및 화면 표시
- ✅ 통화 중 점수와 리포트 점수 일치 보장

### 3. 리포트 생성
- ✅ 통화 종료 시 자동 리포트 생성
- ✅ 판별 결과 (정상/의심/피싱 확정)
- ✅ 판단 근거 표시
- ✅ 스캠 유형 태그 표시
- ✅ 권장 행동 가이드 (결과에 따라 다르게 표시)

### 4. 히스토리 관리
- ✅ 통화 이력 목록 표시
- ✅ 유형별 필터링
- ✅ 번호 검색 기능
- ✅ 코멘트 추가 기능
- ✅ 상세 화면 (번호 클릭 시)

### 5. 네비게이션
- ✅ 홈 화면
- ✅ 히스토리 화면
- ✅ 설정 화면
- ✅ 화면 간 이동

---

## 🔧 주요 기술적 해결 사항

### 1. CORS 문제 해결
- **문제**: 프론트엔드에서 백엔드 API 호출 시 CORS 에러
- **해결**: Flask-CORS 설정을 `CORS(app, resources={r"/*": {"origins": "*"}})`로 변경

### 2. 점수 일치 문제 해결
- **문제**: 통화 중 점수와 리포트 점수가 다르게 표시됨
- **원인**: React state 업데이트와 ref 업데이트의 비동기성
- **해결**:
  - `setScamScore` 호출 시 ref도 즉시 업데이트
  - 리포트 생성 시 state와 ref 모두 확인하여 더 높은 값 사용
  - 리포트 생성 직전과 직후에 최신 점수 재확인

### 3. 스타일 병합 문제 해결
- **문제**: JSX에서 스타일 배열 병합 시 오류
- **해결**: `mergeStyles` 헬퍼 함수 구현

### 4. 리포트 생성 실패 처리
- **문제**: 백엔드 응답이 없을 때 리포트 생성 실패
- **해결**: 오프라인 모드에서도 기본 리포트 생성 로직 구현

---

## 📊 현재 상태

### 완료된 부분
- ✅ 기본 UI/UX 구현
- ✅ 통화 시뮬레이션 기능
- ✅ 실시간 스캠 점수 계산
- ✅ 리포트 생성 및 표시
- ✅ 히스토리 관리
- ✅ 데이터 저장 (localStorage)

### 부분 구현된 부분
- ⚠️ 백엔드 API (모의 응답 사용 중)
- ⚠️ 실제 VoIP 통화 (시뮬레이션만 구현)
- ⚠️ 실제 AI 대화 (시뮬레이션 대화 사용)

### 미구현 부분
- ❌ 실제 음성 인식 (STT)
- ❌ 실제 AI 응답 생성 (OpenAI API 연동)
- ❌ 실제 VoIP 통화 (Twilio 연동)
- ❌ 서버 사이드 데이터 저장
- ❌ 사용자 인증
- ❌ 통화 녹음 기능

---

## 🎯 다음 단계 제안

### 단기 개선 사항
1. **실제 AI 대화 연동**
   - OpenAI API 연동
   - 실시간 대화 생성
   - 피싱 패턴에 따른 AI 응답 전략

2. **데이터 저장 개선**
   - 서버 사이드 데이터베이스 연동
   - 통화 이력 서버 저장
   - 사용자별 데이터 관리

3. **UI/UX 개선**
   - 더 나은 디자인
   - 애니메이션 추가
   - 반응형 디자인 개선

### 중장기 개선 사항
1. **실제 통화 기능**
   - Twilio VoIP 연동
   - 음성 인식 (STT) 연동
   - 음성 합성 (TTS) 연동

2. **고급 기능**
   - 통화 녹음 및 재생
   - 통화 이력 분석 대시보드
   - 피싱 패턴 학습 및 개선

3. **보안 강화**
   - 사용자 인증 시스템
   - 데이터 암호화
   - 개인정보 보호 강화

---

## 💡 기술적 특징

### 피싱 패턴 분석 시스템
- **6가지 패턴 정의**: 각 패턴에 가중치 부여
- **누적 점수 계산**: 패턴이 감지될 때마다 점수 증가
- **최소값 보장**: 패턴이 감지되면 최소 50% 보장

### 실시간 점수 계산
- 통화 중 실시간으로 점수 업데이트
- 화면에 즉시 반영
- 리포트 생성 시 정확한 점수 전달

### 사용자 경험
- 당황하고 헷갈리는 AI 응답으로 피싱에 당하는 사람의 심리 반영
- 시간을 끌어서 충분한 패턴 분석 시간 확보
- 결과에 따른 다른 권장 행동 가이드

---

## 📝 참고 문서

- `README.md`: 프로젝트 개요 및 기본 정보
- `SETUP.md`: 설치 및 환경 설정 가이드
- `RUN.md`: 실행 방법
- `TECH_CHOICES.md`: 기술 선택 이유 (Flask vs Django)
- `PROJECT_STRUCTURE.md`: 프로젝트 구조 상세 설명

---

## 🔄 버전 정보

- **현재 버전**: 프로토타입 v1.0
- **마지막 업데이트**: 2024년
- **주요 변경사항**:
  - React Native → 웹앱 전환
  - 실시간 스캠 점수 계산 구현
  - 히스토리 및 상세 기능 추가
  - 점수 일치 문제 해결

---

## 📞 문의 및 제안

프로젝트에 대한 질문이나 개선 제안이 있으시면 이 문서를 참고하여 GPT에게 문의하시기 바랍니다.

**추가할 기능에 대한 아이디어를 GPT에게 물어볼 때 이 문서를 함께 제공하시면 더 정확한 답변을 받을 수 있습니다.**

